<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <title>OpenTheso - Configurations</title>
        <link rel="icon" href="images/icoTheso.jpg" />
        <link rel="stylesheet" type="text/css" href="css/style.css"/>
        <link rel="stylesheet" type="text/css" href="css/menu.css"/>
        <link rel="stylesheet" type="text/css" href="css/index.css" media="screen" />
    </h:head>
    <h:body>
         <style >
            div#menuHead span#buttonMenuPanel div#panelMenu div#panelMenu_content div#onglets div#listeMenu a:nth-child(3){
               border: 3px  solid #956620;
               box-shadow:0px 0px 5px #BD6060;
            }
        </style>
        <ui:include src="dialogs/user/addUserDlg.xhtml" />
        <ui:include src="dialogs/user/editUserDlg.xhtml" />
        <ui:include src="dialogs/prefDlg.xhtml" />
        <ui:include src ="/admin/reorganizing.xhtml" />
        <ui:include src="admin/regenerateAllConceptId.xhtml" />
        <ui:include src="admin/regenerateArkId.xhtml" />
        <ui:include src="admin/regenerateHandleId.xhtml" />        
        <ui:include src="/admin/baseDeDonnes/miseAJourEditDlg.xhtml"/>
        <ui:include src="/dialogs/settings/copyrightEditDlg.xhtml" />
        <!--inlcude pour l'alignement automatique des BT et des domaines -->
        <ui:include src="dialogs/group/alignGroupDlg.xhtml"/>
        <!--include pour le serveur sparql -->
        <ui:include src="dialogs/sparql/sparqlDialg.xhtml" />
        <p:dialog header="Aide" widgetVar="dlgHelp" modal="true" resizable="false" width="600">
            <h1>Configurations</h1>
            Depuis cette page, les administrateurs peuvent gérer les utilisateurs. Il leur est possible de créer/désactiver un compte ou de modifier les droit d'un utilisateur.
            <br/><br/>
            La modification du mot de passe du compte courant est également effective.
            <br/><br/>
            Le choix de la langue de travail préférée de l'utilisateur (pour avoir automatiquement le thésaurus dans cette langue) et la possibilité de modifier le nombre de 
            propositions nécessaires à un candidat pour l'envois automatique d'un e-mail (qui préviendra les administrateurs que ce candidat est fortement demandé) sont à venir.
        </p:dialog>  
       
        <div id="menuHead">
            <div id="menuHeadTop">
            <ui:include src="logo.xhtml" />
            <ui:include src="account.xhtml" />
            <ui:include src="menuThesaurus.xhtml" />
            <ui:include src="menuAll.xhtml" />  <!-- cette archive est dans la racine Web Pages -->
           
            </div>
           
               
        </div>
        <center>


            <!-- gestion des utilisateurs -->
        </center>
        <div id="principaleConf">
            <h:panelGroup rendered="#{user1.haveRights(2)}">
                <fieldset class="fieldUser">
                    <legend><h:outputText value="#{langueBean.getMsg('conf.field1')}" /></legend>
                    <h:form>
                        <p:commandButton value="#{langueBean.getMsg('conf.btnAddUser')}"  update=":idAddUserDlg" oncomplete="PF('addUserDlg').show();" styleClass="styleButton" />

                    </h:form><br/>
                    <p:dataTable id="tabUser" value="#{user1.selectAuthorizedUser()}" var="u" scrollable="true" resizableColumns="true" scrollHeight="450" style="font-family:'Palatino linotype',Times,serif;">
                        <f:facet name="header">
                            <h:outputText value="#{langueBean.getMsg('conf.tabUser')}" />
                        </f:facet>
                        <p:column width="150" headerText="#{langueBean.getMsg('conf.tabUserOpt1')}" rendered="#{!u.isActive}">
                            <h:outputText title="user désactivé" value="#{u.name}" style="color: red; font-style: oblique" />
                        </p:column>
                        <p:column headerText="#{langueBean.getMsg('conf.tabUserOpt1')}" rendered="#{u.isActive}">
                            <h:outputText value="#{u.name}"/>
                        </p:column>
                        <p:column headerText="#{langueBean.getMsg('conf.tabUserOpt2')}">
                            <h:outputText value="#{u.role}" />
                        </p:column>
                        <p:column width="20" >
                            <h:form>
                                <p:commandButton id="cbEditTheso" styleClass="cbSupp" icon="ui-icon-edi" actionListener="#{user1.selectUser(u)}" update=":idEditUserDlg" oncomplete="PF('editUserDlg').show();"/>
                            </h:form>
                        </p:column>
                        <p:column width="20" >
                            <h:form>
                                <p:commandButton id="cbSuppTheso" title="Suprimer l'utilisateur, pour desactive dans edition de l'user" styleClass="cbSupp" icon="ui-icon-supp" actionListener="#{user1.delUser(u.id)}" update=":tabUser" >
                                    <p:confirm header="#{langueBean.getMsg('confirm')}" message="#{langueBean.getMsg('conf.valid1')}" icon="ui-icon-alert" />  
                                </p:commandButton>  

                                <p:confirmDialog global="true" showEffect="fade" hideEffect="explode">  
                                    <p:commandButton value="#{langueBean.getMsg('yes')}" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check"/>  
                                    <p:commandButton value="#{langueBean.getMsg('no')}" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close"/>       
                                </p:confirmDialog> 
                            </h:form>
                        </p:column>
                    </p:dataTable>
                </fieldset>
            </h:panelGroup>

            <!-- Fin gestion des utilisateurs -->


            <fieldset class="fieldMyAccount">
                <legend><h:outputText value="#{langueBean.getMsg('conf.field2')}" /></legend>
                <h:form id="formEditPseudo">
                    <table>
                        <tr>
                            <td colspan="2" style="text-align: center;">
                                <h:outputText value="#{user1.user.name}" styleClass="textInfo" />
                            </td>
                        </tr>
                        <tr>
                            <td><h:outputText value="#{langueBean.getMsg('conf.editPseudo')}" /> : </td>
                            <td><h:inputText value="#{user1.pseudo}" /></td>

                            <td colspan="2" style="text-align: center;">
                                <p:commandButton icon="ui-icon-ok-16" styleClass="styleButton_db" title="#{langueBean.getMsg('conf.editPseudo')}" actionListener="#{user1.renamePseudo}" 
                                                      update=":formEditPseudo, :tabUser" />
                            </td>
                        </tr>
                    </table>
                </h:form>
                <hr/>
                <h:form id="formEditPwd">
                    <table>
                        <tr>
                            <td><h:outputText value="#{langueBean.getMsg('conf.currentPwd')}" /> : </td>
                            <td><h:inputSecret value="#{user1.pwdEdit1}" /></td>
                        </tr>
                        <tr>
                            <td><h:outputText value="#{langueBean.getMsg('conf.newPwd1')}" /> : </td>
                            <td><h:inputSecret value="#{user1.pwdEdit2}" /></td>
                        </tr>
                        <tr>
                            <td><h:outputText value="#{langueBean.getMsg('conf.newPwd2')}" /> :</td>
                            <td><h:inputSecret value="#{user1.pwdEdit3}" /></td>

                            <td colspan="2" style="text-align: center;">
                                <p:commandButton icon="ui-icon-ok-16" styleClass="styleButton_db" title="#{langueBean.getMsg('conf.btnEditPwd')}" actionListener="#{user1.changePwd()}" 
                                                      update=":formEditPwd" />
                            </td>
                        </tr>
                    </table>
                </h:form>
                <hr/>
                <h:form id="formEditMail">
                    <table>
                        <tr>
                            <td colspan="2" style="text-align: center;">
                                <h:outputText value="#{user1.user.mail}" styleClass="textInfo"/>
                            </td>
                        </tr>
                        <tr>
                            <td><h:outputText value="#{langueBean.getMsg('conf.newMail')}" /> : </td>
                            <td><h:inputText value="#{user1.mailEdit}" /></td>

                            <td colspan="2" style="text-align: center;">
                                <p:commandButton icon="ui-icon-ok-16" styleClass="styleButton_db" title="#{langueBean.getMsg('conf.editMail')}" actionListener="#{user1.changeMail()}" 
                                                      update=":formEditMail" />
                            </td>
                        </tr>
                    </table>
                </h:form>
            </fieldset>


            <h:panelGroup rendered="#{user1.haveRights(2)}">
                <fieldset class="fieldAdmin">
                    <legend><h:outputText value="#{langueBean.getMsg('menu.div1')}" /></legend>
                    <h:form>
                        <p:menuButton  value="Admin" style="font-family:'Palatino linotype',Times,serif; font-size: 11px;" >
                            <p:menuitem style="background: #CEF0C4" value="#{langueBean.getMsg('conf.modifPref')}"  update=":idPrefDlg" oncomplete="PF('prefDlg').show();" styleClass="styleButton"/>
                            <p:separator />
                            <p:separator />
                            <p:menuitem style="background: #CEF0C4" value="#{langueBean.getMsg('conf.sparql')}" update=":idSparqlPreferencesDlg" oncomplete="PF('sparqlPreferenceDlg').show();" action="#{preferencesAlertBean.loadPreferencesSparql()}" styleClass="styleButton"/>
                                
                            <p:separator />
                            <p:menuitem style="background: #CEF0C4" value="#{langueBean.getMsg('conf.reorganizing')}"  update=":idReorganizing" oncomplete="PF('reorganizing').show();" styleClass="styleButton"/>
                            <p:menuitem style="background: #CEF0C4" value="#{langueBean.getMsg('conf.newId')}"  update=":idRegenerateAllConceptId" oncomplete="PF('regenerateAllConceptId').show();" styleClass="styleButton"/>
                            <p:menuitem style="background: #CEF0C4"  value="#{langueBean.getMsg('conf.alignGroup')}" action="#{newtreeBean.getGroupAndSubGroup(theso.thesaurus.language)}"   styleClass="styleButton" update=":idAlignGroupDlg" oncomplete="PF('alignGroupDlg').show();" />
                            <p:separator />
                            <p:menuitem style="background: #CEF0C4" value="#{langueBean.getMsg('bdd.act')}"  update=":idMiseAJourEditDlg" oncomplete="PF('miseAJourEditDlg').show();" styleClass="styleButton"/>
                            <p:menuitem style="background: #CEF0C4" value="#{langueBean.getMsg('admin.regenerateArk')}"  update=":idRegenerateArkId" oncomplete="PF('regenerateArkId').show();" styleClass="styleButton"/>
                            <p:menuitem style="background: #CEF0C4" value="#{langueBean.getMsg('admin.regenerateHandle')}"  update=":idRegenerateHandleId" oncomplete="PF('regenerateHandleId').show();" styleClass="styleButton"/>                            
                            <p:separator/>
                            <p:menuitem style="background: #CEF0C4" value="#{langueBean.getMsg('copyright.addCopyrightTo')}" action="#{copyrightBean.setDisplayBrutText(false)}" oncomplete="PF('copyrightEditDlg').show()"  styleClass="styleButton"/>
                         

                        </p:menuButton>
                    </h:form>
                </fieldset>
            </h:panelGroup>



        </div>
        <ui:include src="gestionnaire/gestinnaireFin.xhtml"/> <!-- cette archive est dans Web Pages/gestoinnaire  -->
        <ui:insert name="status">
            <p:ajaxStatus>
                <f:facet name="start">
                    <p:graphicImage id="iconeLoad" value="/images/loading.gif" width="200" />
                </f:facet>

                <f:facet name="complete">
                    <h:outputText value="" />
                </f:facet>
            </p:ajaxStatus>
        </ui:insert>
    </h:body>
</html>
